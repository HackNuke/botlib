#!/usr/bin/python3
# BOTLIB - the bot library
#
# run unittests.

import os, shutil, time, unittest

from bot.csl import execute
from bot.krn import k, starttime
from bot.obj import cdir, update
from bot.prs import parse_cli, setwd
from bot.tms import elapsed

def debug():
    import bot.rss
    bot.rss.debug = True

def main():
    if os.path.exists(".data"):
        shutil.rmtree(".data")
    cfg = parse_cli()
    setwd(".data")
    debug()
    update(k.cfg, cfg)
    k.start()
    k.walk("bot")
    test_path = os.getcwd() + os.sep + "tests"
    if cfg.txt:
        pat = "test_%s*" % cfg.txt
    else:
        pat = "test_*"
    print("using %s" % pat)
    suite = unittest.loader.TestLoader().discover(test_path, pattern=pat)
    unittest.TextTestRunner(verbosity=3).run(suite)
   
execute(main)

print(elapsed(time.time() - starttime))
os._exit(0)
