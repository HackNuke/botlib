#!/usr/bin/env python3
# This file is placed in the Public Domain.

import os
import shutil
import sys
import unittest

sys.path.insert(0, "bot")

from hdl import Client
from krn import Kernel
from nms import Names
from obj import cfg, opts
from prs import boot
from tbl import table
from trm import exec

import trc
import url

mods = "adm,fnd,irc,log,rss,tdo,udp"

class Test(Client):

    def raw(self, txt):
        if opts("v"):
            print(txt)

def main():
    if os.path.exists(".test"):
        shutil.rmtree(".test")
    Names.tbl(table)
    k = Kernel()
    k.boot()
    url.debug = True
    cfg.wd = ".test"
    c = Test()
    k.regs(mods)
    c.start()
    pat = "test_%s*" % "*"
    suite = unittest.loader.TestLoader().discover("test", pattern=pat)
    unittest.TextTestRunner(verbosity=3).run(suite)

exec(main)
for e in trc.exc:
    print(e)
