#!/usr/bin/env python3
# This file is placed in the Public Domain.

import os
import shutil
import sys
import unittest

sys.path.insert(0, "bot")

import obj

from hdl import Client
from krn import Kernel
from obj import Names
from trm import exec
from run import opts
from ver import __version__

import trc
import url

class Test(Client):

    def raw(self, txt):
        if opts("v"):
            print(txt)

def main():
    if os.path.exists(".test"):
        shutil.rmtree(".test")
    obj.wd = ".test"
    url.debug = True
    k = Kernel()
    k.boot("test", __version__)
    k.scan(os.path.join(os.getcwd(), "mod"))
    c = Test()
    c.start()
    pat = "test_%s*" % "*"
    suite = unittest.loader.TestLoader().discover("test", pattern=pat)
    unittest.TextTestRunner(verbosity=3).run(suite)

exec(main)
for e in trc.exc:
    print(e)
