#!/usr/bin/python3
#
# run unittests.

import logging, os, shutil, time, unittest
import bot.obj

from bot.run import execute, k, parse_cli, starttime
from bot.tms import elapsed

def cdir(path):
    if os.path.exists(path):
        return
    res = ""
    path2, fn = os.path.split(path)
    for p in path2.split(os.sep):
        res += "%s%s" % (p, os.sep)
        padje = os.path.abspath(os.path.normpath(res))
        try:
            os.mkdir(padje)
        except (IsADirectoryError, NotADirectoryError, FileExistsError):
            pass
    return True


def main():
    if os.path.exists(".data"):
        shutil.rmtree(".data")
    cfg = parse_cli()
    bot.obj.workdir = ".data"
    k.start()
    k.walk("bot")
    test_path = os.getcwd() + os.sep + "tests"
    suite = unittest.loader.TestLoader().discover(test_path, pattern="test*")
    unittest.TextTestRunner(verbosity=3).run(suite)
    k.wait()
   
execute(main)

print(elapsed(time.time() - starttime))
os._exit(0)
