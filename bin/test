#!/usr/bin/env python3
# This file is placed in the Public Domain.

import os, sys ; sys.path.insert(0, os.getcwd())

from bot.hdl import Client
from bot.obj import cfg, opts
from bot.trm import exec
from bot.zzz import shutil, unittest

import bot.trc
import bot.url

class Test(Client):

    def raw(self, txt):
        if opts("v"):
            print(txt)

class FlushTest(Test):

    def raw(self, txt):
        if opts("v"):
            sys.stdout.write(txt)
            sys.stdout.write("\n")

def main():
    if os.path.exists(".test"):
        shutil.rmtree(".test")
    bot.url.debug = True
    cfg.wd = ".test"
    c = FlushTest()
    c.boot()
    c.start()
    pat = "test_%s*" % "*"
    suite = unittest.loader.TestLoader().discover("test", pattern=pat)
    unittest.TextTestRunner(verbosity=3).run(suite)

exec(main)
for e in bot.trc.exc:
    print(e)
