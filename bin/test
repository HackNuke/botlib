#!/usr/bin/env python3
# This file is placed in the Public Domain.

import os, sys ; sys.path.insert(0, os.getcwd())

import time
import unittest

from bot import c, cfg, op
from bot.bus import Bus
from bot.csl import Test, exec, parse

import bot.utl

def open(txt):
    try:
        for line in os.popen(txt).readlines():
            print(line.rstrip())
    except:
        pass

def main():
    cfg.wd = c(".test")
    cfg.pkgs = "ob,obm,mod"
    parse()
    open("rm -fR %s" % cfg.wd)
    bot.utl.debug = True
    bot.rss.debug = True
    pat = "test_%s*" % cfg.cmd or "*"
    print(cfg, pat)
    suite = unittest.loader.TestLoader().discover("test", pattern=pat)
    unittest.TextTestRunner(verbosity=3).run(suite)
    Bus.wait(Test)

exec(main)
