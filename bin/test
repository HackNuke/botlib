#!/usr/bin/env python3
# This file is placed in the Public Domain.


import os, sys ; sys.path.insert(0, os.getcwd())


import doctest
import os
import unittest


from bot.clt import Client
from bot.krn import getmain
from bot.obj import Cfg
from bot.run import Runtime
from bot.run import Cfg as RunCfg


Cfg.wd = ".test"
flags = doctest.REPORT_NDIFF | doctest.FAIL_FAST | doctest.ELLIPSIS


class Kernel(Runtime):

    def error(self, txt):
        print(txt)
        sys.stdout.flush()

    def log(self, txt):
        k = getmain("k")
        if k.cfg.verbose:
            print(txt)
            sys.stdout.flush()


k = Runtime()

class CLI(Client):

    def __init__(self):
        super().__init__()
        k.add(self)

    def raw(self, txt):
        if k.cfg.verbose:
            print(txt)
            sys.stdout.flush()


clt = CLI()


import bot.all


def main():
    k.parse_cli()
    k.cfg.debug = True
    k.cfg.mod = "irc,rss"
    pat = "test_%s*" % "*"
    suite = unittest.loader.TestLoader().discover("tests", pattern=pat)
    unittest.TextTestRunner(verbosity=3).run(suite)


main()
