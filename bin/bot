#!/usr/bin/env python3
# This file is placed in the Public Domain.


import os
import sys
import termios


sys.path.insert(0, os.getcwd())


from bot.clt import Client
from bot.krn import k
from bot.hdl import cmd

from run import daemon, wrap


class Console(Client):

    def handle(self, event):
        super().handle(event)
        event.wait()

    def poll(self):
        return input("> ")

    def raw(self, txt):
        print(txt)


import bot.all


def main():
    k.parse_cli(" ".join(sys.argv[1:]))
    k.scan()
    k.start()
    console = k.opt("c") or k.cfg.mod
    if k.prs.txt:
        import readline
        c = Console()
        return cmd(c, k.prs.otxt)
    if k.opt("d"):
        daemon()
        console = False
    k.init(k.cfg.mod, "bot")
    if console:
        csl = Console()
        csl.start()
    if console or k.opt("d"):
        k.wait()


wrap(main)
