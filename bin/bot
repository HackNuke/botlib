#!/usr/bin/env python3
# This file is placed in the Public Domain.

import os
import sys 

sys.path.insert(0, "bot")

import obj

from hdl import Client
from krn import Kernel
from obj import fmt
from run import opts
from trm import exec
from ver import __version__

class CLI(Client):

    def raw(self, txt):
        print(txt)

class Console(CLI):

    def handle(self, e):
        super().handle(e)
        e.wait()

    def poll(self):
        return input("> ")

def main():
    obj.wd = os.path.expanduser("~/.bot")
    k = Kernel()
    k.boot("bot", __version__)
    k.scan(os.path.join(obj.wd, "mod"))
    if k.cfg.txt:
        c = CLI()
        return c.cmd(k.cfg.otxt)
    if k.cfg.mods or opts("c"):
        c = Console()
        k.inits(k.cfg.mods)
        c.start()
        c.wait()

exec(main)
