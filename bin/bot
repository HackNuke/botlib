#!/usr/bin/python3 -u
# BOTLIB - the bot library !
#
#

__version__ = 86

import os, sys ; sys.path.insert(0, os.getcwd())

from bot.csl import Console
from bot.dbs import last
from bot.irc import Cfg, IRC
from bot.krn import k
from bot.obj import format, save
from bot.shl import daemon, execute, parse_cli

import sys

def cfg(event):
    c = Cfg()
    last(c)
    if event.sets:
        c.update(event.sets)
        save(c)
    event.reply(format(c))

def main():
    c = parse_cli()
    k.cmds.register("cfg", cfg)
    if c.txt:
        return k.cmd(c.txt, c)
    k.start()
    wait = False
    if "d" in c.opts:
        daemon()
        wait = True
    if "i" in c.opts:
        i = IRC()
        i.start()
        wait = True
    if "s" in c.opts:
        c = Console()
        c.start()
        wait = True
    if wait:
        k.wait()

execute(main)
