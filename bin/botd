#!/usr/bin/env python3
# This file is placed in the Public Domain.


"object command"


import inspect
import os
import sys
import termios
import traceback


sys.path.insert(0, "lib")
sys.path.insert(0, os.getcwd())

from odb import Cfg
from otb import Cls, Cmd, Obj
from oev import Event
from ohd import Handler
from otb import Cmd, Obj
from oth import launch


from bot.irc import IRC
from bot.irc import Cfg as ICfg
from bot.rss import Fetcher

ICfg.channel = "#botd"
ICfg.nick = "botd"


import bot.all


Cfg.wd = "/var/lib/botd"


class CLI(Handler):

    def cmd(self, txt):
        self.handle(Event(txt, repr(self)))
                
    def raw(self, txt):
        print(txt)


def daemon():
    pid = os.fork()
    if pid != 0:
        os._exit(0)
    os.setsid()
    os.umask(0)
    si = open("/dev/null", 'r')
    so = open("/dev/null", 'a+')
    se = open("/dev/null", 'a+')
    os.dup2(si.fileno(), sys.stdin.fileno())
    os.dup2(so.fileno(), sys.stdout.fileno())
    os.dup2(se.fileno(), sys.stderr.fileno())


def main():
    txt = " ".join(sys.argv[1:])
    i = IRC()
    i.start()
    f = Fetcher()
    f.start()
    c = CLI()
    c.start()
    c.wait()


main()
