#!/usr/bin/env python3
# This file is placed in the Public Domain.


"bot service"


import inspect
import os
import sys
import termios
import time
import traceback


from ot.bus import Bus
from ot.cls import Cls
from ot.cmd import Cmd
from ot.dbs import Cfg
from ot.evt import Event
from ot.obj import Object, update, values
from ot.prs import parse
from ot.hdl import Handler
from ot.tbl import Tbl
from ot.tms import tfmt
from ot.thr import launch


import ot.all
import bot.all


from bot.irc import IRC
from bot.rss import Fetcher


Cfg.wd = "/var/lib/botd/"


def scan():
    for mod in values(Tbl.mod):
        for k, o in inspect.getmembers(mod, inspect.isfunction):
            if "event" in o.__code__.co_varnames:
                Cmd.cmds[k] = o
        for k, clz in inspect.getmembers(mod, inspect.isclass):
            Cls.add(clz)
        Tbl.add(mod)


def main():
    scan()
    i = IRC()
    i.start()
    f = Fetcher()
    f.start()
    while 1:
        time.sleep(1.0)


main()
