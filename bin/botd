#!/usr/bin/env python3
# This file is placed in the Public Domain.


"24/7 channel daemon"


import inspect
import time


from ol.cls import Cls
from ol.cmd import Cmd
from ol.dbs import Cfg
from ol.obj import values
from ol.tbl import Tbl


import bot.all


from bot.irc import IRC
from bot.rss import Fetcher


Cfg.wd = "/var/lib/botd/"


def scan():
    "scan registered modules"
    for mod in values(Tbl.mod):
        for k, o in inspect.getmembers(mod, inspect.isfunction):
            if "event" in o.__code__.co_varnames:
                Cmd.cmds[k] = o
        for k, clz in inspect.getmembers(mod, inspect.isclass):
            Cls.add(clz)
        Tbl.add(mod)


def main():
    "main function"
    scan()
    i = IRC()
    i.start()
    f = Fetcher()
    f.start()
    while 1:
        time.sleep(1.0)

main()
