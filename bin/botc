#!/usr/bin/env python3
# This file is placed in the Public Domain.


"bot command"


import inspect
import os
import sys


from op.cfg import Cfg
from op.cls import Cls
from op.cmd import Cmd
from op.krn import boot, kcmd
from op.obj import values
from op.hdl import Handler
from op.tbl import Tbl


import bot.all


Cfg.wd = "/var/lib/botd/"


class CLI(Handler):

    "command line interface"

    def raw(self, txt):
        print(txt)


def scan():
    "scan registered modules"
    for mod in values(Tbl.mod):
        for k, o in inspect.getmembers(mod, inspect.isfunction):
            if "event" in o.__code__.co_varnames:
                Cmd.cmds[k] = o
        for k, clz in inspect.getmembers(mod, inspect.isclass):
            Cls.add(clz)
        Tbl.add(mod)


def main():
    "main function"
    scan()
    cfg = boot(" ".join(sys.argv[1:]))
    if cfg.txt:
        c = CLI()
        kcmd(c, cfg.otxt)

main()
