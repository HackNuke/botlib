#!/usr/bin/env python3
# This file is placed in the Public Domain.


import os, sys ; sys.path.insert(0, os.getcwd())


import readline
import sys
import termios


from bot.clt import Client
from bot.krn import k
from bot.run import spl


import bot.all


class Console(Client):

    def handle(self, clt, e):
        super().handle(self, e)
        e.wait()

    def poll(self):
        return input("> ")
        
    def raw(self, txt):
        print(txt)


def wrap(func):
    fd = sys.stdin.fileno()
    old = termios.tcgetattr(fd)
    try:
        func()
    except (EOFError, KeyboardInterrupt):
        print("")
    finally:
        termios.tcsetattr(fd, termios.TCSADRAIN, old)



def main():
    k.parse_cli(" ".join(sys.argv[1:]))
    clt = Console()
    k.add(clt)
    for mn in spl(k.cfg.mod):
        k.init("bot.%s" % mn)
    clt.start()
    k.wait()


wrap(main)
