#!/usr/bin/env python3
# This file is placed in the Public Domain.

import os
import sys 

sys.path.insert(0, "bot")

from hdl import Client, docmd
from krn import Kernel
from obj import merge
from run import opts
from trm import exec
from ver import __version__

import obj

class CLI(Client):

    def handle(self, e):
        super().handle(e)
        e.wait()

    def raw(self, txt):
        print(txt)

class Console(CLI):

    def poll(self):
        return input("> ")

def main():
    obj.wd = "/var/lib/bot"
    k = Kernel()
    k.boot("bots", __version__)
    k.scan(os.path.join(obj.wd, "mod"))
    if k.cfg.txt:
        c = CLI()
        return c.cmd(k.cfg.otxt)
    if opts("c"):
        c = Console()
    else:
        c = Client()
    if k.cfg.mods:     
        k.inits(k.cfg.mods)
        c.start()
        c.wait()

exec(main)
