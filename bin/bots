#!/usr/bin/env python3
# This file is placed in the Public Domain.

__version__ = 42

from botl.clt import Client
from botl.krn import Kernel, kcmd, privileges
from botl.obj import cfg

import botl.all
import botd.all

import os

all = "adm,cms,fnd,irc,krn,log,rss,slg,tdo"
name = "botd"

class CLI(Client):

    def __init__(self):
        super().__init__()
        self.initialize(kcmd)

    def raw(self, txt):
        print(txt)

def ver(event):
    event.reply("%s %s" % (name.upper(), __version__))

def main():
    cfg.wd = "/var/lib/%s/" % name
    k = Kernel()
    k.addcmd(ver)
    k.boot(name, all)
    privileges(name)
    if k.cfg.txt:
        c = CLI()
        e = c.event(k.cfg.otxt)
        kcmd(c, e)
        e.wait()
        return
    k.init(all)
    k.wait()

if __name__ == "__main__":
    main()
